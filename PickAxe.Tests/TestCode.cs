//------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated by a tool.
//     Runtime Version:4.0.30319.34014
//
//     Changes to this file may cause incorrect behavior and will be lost if
//     the code is regenerated.
// </auto-generated>
//------------------------------------------------------------------------------

using HtmlAgilityPack;
using Pickaxe.Runtime;
using System;
using System.Collections.Generic;
using System.Linq;



public class Code : RuntimeBase
{

    private Scope_0063590f74544cdf807670ad2cfaa2e1 _Scope_0063590f74544cdf807670ad2cfaa2e1;

    private Scope_c1a27073e0704c528b30baddb000754d _Scope_c1a27073e0704c528b30baddb000754d;

    public Code()
    {
        _Scope_0063590f74544cdf807670ad2cfaa2e1 = new Scope_0063590f74544cdf807670ad2cfaa2e1();
        _Scope_c1a27073e0704c528b30baddb000754d = new Scope_c1a27073e0704c528b30baddb000754d();
        TotalOperations = (TotalOperations + 1);
    }

    public void Run()
    {
        InitProxies();
        Block_84a6caa6b98549cd85ae1e892e5b63b7();
        Step_42561808ed8a4034bd9ecfbe37cc3a03();
    }

    public void Block_84a6caa6b98549cd85ae1e892e5b63b7()
    {
        Step_1fe761e61c3e4f47a4c80e7bff6bec1e();
    }

    private CodeTable<anon_631d5cec8c7944c8b018fe510d2f814b> From_01945714df13450dbfc55f5acadc9ba3()
    {
        Call(5);
        IEnumerable<anon_631d5cec8c7944c8b018fe510d2f814b> join = Fetch_6db6741802ed4a43bfbf563b04ce74b8();
        CodeTable<anon_631d5cec8c7944c8b018fe510d2f814b> newTable = new CodeTable<anon_631d5cec8c7944c8b018fe510d2f814b>();
        newTable.SetRows(join.ToList());
        return newTable;
    }

    private RuntimeTable<DownloadPage> Download_917c6dafd49b44f196a6c521cc356c31()
    {
        Call(5);
        return Http.DownloadPage(this, "http://mock.com", 5);
    }

    private IEnumerable<anon_631d5cec8c7944c8b018fe510d2f814b> Fetch_6db6741802ed4a43bfbf563b04ce74b8()
    {
        RuntimeTable<DownloadPage> table = Download_917c6dafd49b44f196a6c521cc356c31();
        return table.Select(o =>
        {
            return Copy_b79f73d7615348778271f206e141fe6f(o);
        });
    }

    private anon_631d5cec8c7944c8b018fe510d2f814b Copy_b79f73d7615348778271f206e141fe6f(DownloadPage o)
    {
        anon_631d5cec8c7944c8b018fe510d2f814b t = new anon_631d5cec8c7944c8b018fe510d2f814b();
        t.DownloadPage = o;
        return t;
    }

    private Table<ResultRow> Select_5ce474e6ca1c406fba09b94d237b5131()
    {
        Call(3);
        RuntimeTable<ResultRow> result = new RuntimeTable<ResultRow>();
        result.AddColumn("(No column name)");
        CodeTable<anon_631d5cec8c7944c8b018fe510d2f814b> fromTable = From_01945714df13450dbfc55f5acadc9ba3();
        fromTable = Where_4aa6a7f5bba5470e99beac277cdf388d(fromTable);
        IEnumerator<anon_631d5cec8c7944c8b018fe510d2f814b> x = fromTable.GetEnumerator();
        for (
        ; x.MoveNext();
        )
        {
            anon_631d5cec8c7944c8b018fe510d2f814b row = x.Current;
            IEnumerator<HtmlNode> y = row.DownloadPage.nodes.GetEnumerator();
            for (
            ; y.MoveNext();
            )
            {
                HtmlNode node = y.Current;
                ResultRow resultRow = new ResultRow(1);
                resultRow[0] = Case_ed953c4827df46e798b20befa0f63d60(row, node);
                if ((resultRow[0] != null))
                {
                    result.Add(resultRow);
                }
            }
        }
        OnSelect(result);
        return result;
    }

    private object Case_5bb5195c4641475ea98fe8b72810ce22(anon_631d5cec8c7944c8b018fe510d2f814b row, HtmlNode node)
    {
        Call(4);
        if ((Convert.ToInt32(node.Pick("li:first-child").TakeText().Match("[\\d\\.]+")) < 9000))
        {
            return 2;
        }
        return null;
    }

    private object Case_ed953c4827df46e798b20befa0f63d60(anon_631d5cec8c7944c8b018fe510d2f814b row, HtmlNode node)
    {
        Call(4);
        if ((Convert.ToInt32(node.Pick("li:first-child").TakeText().Match("[\\d\\.]+")) < 9000))
        {
            return 2;
        }
        return null;
    }

    private CodeTable<anon_631d5cec8c7944c8b018fe510d2f814b> Where_4aa6a7f5bba5470e99beac277cdf388d(CodeTable<anon_631d5cec8c7944c8b018fe510d2f814b> table)
    {
        Call(6);
        CodeTable<anon_631d5cec8c7944c8b018fe510d2f814b> newTable = new CodeTable<anon_631d5cec8c7944c8b018fe510d2f814b>();
        IList<anon_631d5cec8c7944c8b018fe510d2f814b> rows = table.Where(row =>
        {
            return (true
                && (row.DownloadPage.size < 10));
        }).ToList();

        newTable.SetRows(rows);

        IEnumerator<anon_631d5cec8c7944c8b018fe510d2f814b> i = table.GetEnumerator();
        for (
           ; i.MoveNext();
           )
        {
            anon_631d5cec8c7944c8b018fe510d2f814b row = i.Current;
            row.DownloadPage.CssWhere("#match-tests");
        }

        return newTable;
    }

    public void Step_1fe761e61c3e4f47a4c80e7bff6bec1e()
    {
        Select_5ce474e6ca1c406fba09b94d237b5131();
        OnProgress();
    }

    public void Step_42561808ed8a4034bd9ecfbe37cc3a03()
    {
        OnProgress(new ProgressArgs(TotalOperations, TotalOperations));
    }

    private class Scope_0063590f74544cdf807670ad2cfaa2e1
    {

        public int g_identity;

        public Scope_0063590f74544cdf807670ad2cfaa2e1()
        {
        }
    }

    private class Scope_c1a27073e0704c528b30baddb000754d
    {

        public Scope_c1a27073e0704c528b30baddb000754d()
        {
        }
    }

    private class anon_631d5cec8c7944c8b018fe510d2f814b : IRow
    {

        public DownloadPage DownloadPage;
    }
}
