//------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated by a tool.
//     Runtime Version:4.0.30319.34014
//
//     Changes to this file may cause incorrect behavior and will be lost if
//     the code is regenerated.
// </auto-generated>
//------------------------------------------------------------------------------

using HtmlAgilityPack;
using Pickaxe.Runtime;
using System;
using System.Collections.Generic;
using System.Linq;



public class Code : RuntimeBase
{

    private Scope_d24a2fd890254b7da3e318e65a8c43f8 _Scope_d24a2fd890254b7da3e318e65a8c43f8;

    private Scope_31c766f4130c41dc90b7c9c3e8a317db _Scope_31c766f4130c41dc90b7c9c3e8a317db;

    public Code(string[] args) :
        base(args)
    {
        _Scope_d24a2fd890254b7da3e318e65a8c43f8 = new Scope_d24a2fd890254b7da3e318e65a8c43f8();
        _Scope_31c766f4130c41dc90b7c9c3e8a317db = new Scope_31c766f4130c41dc90b7c9c3e8a317db();
        TotalOperations = (TotalOperations + 1);
    }

    public void Run()
    {
        InitProxies();
        Block_90c026519dc7467197aca1e9383255ec();
        Step_a24928087a444cd18e9d0bef609dff4d();
    }

    public void Block_90c026519dc7467197aca1e9383255ec()
    {
        Step_79bf7143464a4b3daa4603b580b02096();
    }

    private CodeTable<anon_43be34f76cfc4b8c8455ada23235b38b> From_82643d6fbeb74e2587615237fb8d2dad()
    {
        Call(7);
        IEnumerable<anon_43be34f76cfc4b8c8455ada23235b38b> join = Fetch_186ce538e00249f48f45aab7b19a4242();
        CodeTable<anon_43be34f76cfc4b8c8455ada23235b38b> newTable = new CodeTable<anon_43be34f76cfc4b8c8455ada23235b38b>();
        newTable.SetRows(join.ToList());
        return newTable;
    }

    private RuntimeTable<DownloadPage> Download_a81be78d5bc3459ea48149eaafe07c02()
    {
        Call(7);
        return new SelectDownloadTable(Pickaxe.Runtime.LazyDownloadArgs.CreateSeleniumArgs(this, 7, 10, "\'table[width=\"600\"] tr\'", ""));
    }

    private IEnumerable<anon_43be34f76cfc4b8c8455ada23235b38b> Fetch_186ce538e00249f48f45aab7b19a4242()
    {
        RuntimeTable<DownloadPage> table = Download_a81be78d5bc3459ea48149eaafe07c02();
        return table.Select(o =>
        {
            return Copy_b2bc8ed956d142f9a723569b0ad845f2(o);
        });
    }

    private anon_43be34f76cfc4b8c8455ada23235b38b Copy_b2bc8ed956d142f9a723569b0ad845f2(DownloadPage o)
    {
        anon_43be34f76cfc4b8c8455ada23235b38b t = new anon_43be34f76cfc4b8c8455ada23235b38b();
        t.DownloadPage = o;
        return t;
    }

    private Table<ResultRow> Select_0fea270752114895807c25a2209e0f2c()
    {
        Call(3);
        RuntimeTable<ResultRow> result = new RuntimeTable<ResultRow>();
        result.AddColumn("td:nth-child(1) p.bold");
        result.AddColumn("td:nth-child(1) p.bold");
        result.AddColumn("td:nth-child(2) p");
        CodeTable<anon_43be34f76cfc4b8c8455ada23235b38b> fromTable = From_82643d6fbeb74e2587615237fb8d2dad();
        fromTable = Where_8835b31558c94f64a868bf4f41719964(fromTable);
        IEnumerator<anon_43be34f76cfc4b8c8455ada23235b38b> x = fromTable.GetEnumerator();
        for (
        ; x.MoveNext();
        )
        {
            anon_43be34f76cfc4b8c8455ada23235b38b row = x.Current;
            IEnumerator<HtmlNode> y = row.DownloadPage.nodes.GetEnumerator();
            for (
            ; y.MoveNext();
            )
            {
                HtmlNode node = y.Current;
                ResultRow resultRow = new ResultRow(3);
                resultRow[0] = node.Pick("td:nth-child(1) p.bold").TakeText().MatchReplace("(\\d+)-(\\w+)", "$2");
                resultRow[1] = node.Pick("td:nth-child(1) p.bold").TakeText().MatchReplace("(\\d+)-(\\w+)", "$1");
                resultRow[2] = node.Pick("td:nth-child(2) p").TakeText().Match("\\d{3}\\.\\d{2}");
                if ((((resultRow[0] != null)
                            && (resultRow[1] != null))
                            && (resultRow[2] != null)))
                {
                    result.Add(resultRow);
                }
            }
            row.DownloadPage.Clear();
        }
        OnSelect(result);
        return result;
    }

    private CodeTable<anon_43be34f76cfc4b8c8455ada23235b38b> Where_8835b31558c94f64a868bf4f41719964(CodeTable<anon_43be34f76cfc4b8c8455ada23235b38b> table)
    {
        Call(8);
        CodeTable<anon_43be34f76cfc4b8c8455ada23235b38b> newTable = new CodeTable<anon_43be34f76cfc4b8c8455ada23235b38b>();
        IList<anon_43be34f76cfc4b8c8455ada23235b38b> rows = table.Where(row =>
        {
            return true;
        }).ToList();
        newTable.SetRows(rows);
        IEnumerator<anon_43be34f76cfc4b8c8455ada23235b38b> i = newTable.GetEnumerator();
        for (
        ; i.MoveNext();
        )
        {
            anon_43be34f76cfc4b8c8455ada23235b38b row = i.Current;
            row.DownloadPage = row.DownloadPage.CssWhere("table[width=\"600\"] tr");
        }
        return newTable;
    }

    public void Step_79bf7143464a4b3daa4603b580b02096()
    {
        Select_0fea270752114895807c25a2209e0f2c();
        OnProgress();
    }

    public void Step_a24928087a444cd18e9d0bef609dff4d()
    {
        OnProgress(new ProgressArgs(TotalOperations, TotalOperations));
    }

    private class Scope_d24a2fd890254b7da3e318e65a8c43f8
    {

        public int g_identity;

        public Scope_d24a2fd890254b7da3e318e65a8c43f8()
        {
        }
    }

    private class Scope_31c766f4130c41dc90b7c9c3e8a317db
    {

        public Scope_31c766f4130c41dc90b7c9c3e8a317db()
        {
        }
    }

    private class anon_43be34f76cfc4b8c8455ada23235b38b : IRow
    {

        public DownloadPage DownloadPage;
    }
}
