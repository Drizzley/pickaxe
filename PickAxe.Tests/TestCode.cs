//------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated by a tool.
//     Runtime Version:4.0.30319.34014
//
//     Changes to this file may cause incorrect behavior and will be lost if
//     the code is regenerated.
// </auto-generated>
//------------------------------------------------------------------------------

using Pickaxe.Runtime;
using Pickaxe.Runtime.Dom;
using System;
using System.Collections.Generic;
using System.Linq;



public class Code : RuntimeBase
{

    private Scope_9f5fe3f765df4aea8674898da28507b1 _Scope_9f5fe3f765df4aea8674898da28507b1;

    private Scope_61f4e38e4a504b83b816ad41eb5f0775 _Scope_61f4e38e4a504b83b816ad41eb5f0775;

    public Code(string[] args) :
        base(args)
    {
        _Scope_9f5fe3f765df4aea8674898da28507b1 = new Scope_9f5fe3f765df4aea8674898da28507b1();
        _Scope_61f4e38e4a504b83b816ad41eb5f0775 = new Scope_61f4e38e4a504b83b816ad41eb5f0775();
        TotalOperations = (TotalOperations + 1);
    }

    public void Run()
    {
        InitProxies();
        Block_8b73ba1118c1455facd7c5d488e2219d();
        Step_425b7f53a42945cc81285345532de574();
    }

    public void Block_8b73ba1118c1455facd7c5d488e2219d()
    {
        Step_f6aefd7c0765443e9efde3cea97d56a2();
    }

    private CodeTable<anon_01d4cc8e3a2b48319db0232f6443d89a> From_ad8aa9c326c9452ba50cac2f75ee1528()
    {
        Call(6);
        IEnumerable<anon_01d4cc8e3a2b48319db0232f6443d89a> join = Fetch_4a607ffd6aa34e16991a286b597875c8();
        CodeTable<anon_01d4cc8e3a2b48319db0232f6443d89a> newTable = new CodeTable<anon_01d4cc8e3a2b48319db0232f6443d89a>();
        newTable.SetRows(join.ToList());
        return newTable;
    }

    private CodeTable<anon_c2089cb8821a4e9db698549f77af2c7d> From_4cd3e4a2d8c24a1189aa9a61179a6cf3()
    {
        Call(10);
        IEnumerable<anon_c2089cb8821a4e9db698549f77af2c7d> join = Fetch_f104a606780f4ed2aa43a00e7ae9780d();
        CodeTable<anon_c2089cb8821a4e9db698549f77af2c7d> newTable = new CodeTable<anon_c2089cb8821a4e9db698549f77af2c7d>();
        newTable.SetRows(join.ToList());
        return newTable;
    }

    private RuntimeTable<DownloadPage> Download_a1cd0066085b46d1b6a9239c5128b460()
    {
        Call(10);
        return new SelectDownloadTable(Pickaxe.Runtime.LazyDownloadArgs.CreateWebRequestArgs(this, 10, 1, "http://vtss.brockreeve.com/?t=All"));
    }

    private IEnumerable<anon_c2089cb8821a4e9db698549f77af2c7d> Fetch_f104a606780f4ed2aa43a00e7ae9780d()
    {
        RuntimeTable<DownloadPage> table = Download_a1cd0066085b46d1b6a9239c5128b460();
        return table.Select(o =>
        {
            return Copy_00745c2f0e644937b1ef9ac3d6275866(o);
        });
    }

    private anon_c2089cb8821a4e9db698549f77af2c7d Copy_00745c2f0e644937b1ef9ac3d6275866(DownloadPage o)
    {
        anon_c2089cb8821a4e9db698549f77af2c7d t = new anon_c2089cb8821a4e9db698549f77af2c7d();
        t.DownloadPage = o;
        return t;
    }

    private CodeTable<t> Nested_Select_d461323b0bb546eba5d15919df0f4acf()
    {
        Call(8);
        CodeTable<t> result = new BufferTable<t>();
        CodeTable<anon_c2089cb8821a4e9db698549f77af2c7d> fromTable = From_4cd3e4a2d8c24a1189aa9a61179a6cf3();
        fromTable = Where_6b6fa60ad8a544089f37b232e722902a(fromTable);
        IEnumerator<anon_c2089cb8821a4e9db698549f77af2c7d> x = fromTable.GetEnumerator();
        for (
        ; x.MoveNext();
        )
        {
            anon_c2089cb8821a4e9db698549f77af2c7d row = x.Current;
            IEnumerator<HtmlElement> y = row.DownloadPage.nodes.GetEnumerator();
            for (
            ; y.MoveNext();
            )
            {
                HtmlElement node = y.Current;
                t resultRow = new t();
                resultRow.page = node.Pick("li.current a").TakeText();
                resultRow.p = node.Pick("li:nth-child(7) a").TakeText();
                result.Add(resultRow);
            }
            row.DownloadPage.Clear();
        }
        return result;
    }

    private CodeTable<anon_c2089cb8821a4e9db698549f77af2c7d> Where_6b6fa60ad8a544089f37b232e722902a(CodeTable<anon_c2089cb8821a4e9db698549f77af2c7d> table)
    {
        Call(11);
        CodeTable<anon_c2089cb8821a4e9db698549f77af2c7d> newTable = new CodeTable<anon_c2089cb8821a4e9db698549f77af2c7d>();
        IList<anon_c2089cb8821a4e9db698549f77af2c7d> rows = table.Where(row =>
        {
            return row.DownloadPage.CssWhere(ref row.DownloadPage, "ol.page-nav");
        }).ToList();
        newTable.SetRows(rows);
        return newTable;
    }

    private IEnumerable<anon_01d4cc8e3a2b48319db0232f6443d89a> Fetch_4a607ffd6aa34e16991a286b597875c8()
    {
        CodeTable<t> table = Nested_Select_d461323b0bb546eba5d15919df0f4acf();
        return table.Select(o =>
        {
            return Copy_05cdcfad56eb48ecb02822312942fac4(o);
        });
    }

    private anon_01d4cc8e3a2b48319db0232f6443d89a Copy_05cdcfad56eb48ecb02822312942fac4(t o)
    {
        anon_01d4cc8e3a2b48319db0232f6443d89a t = new anon_01d4cc8e3a2b48319db0232f6443d89a();
        t.t = o;
        return t;
    }

    private Table<ResultRow> Select_7ca4bd87ff3f4827a109268f4535bbd8()
    {
        Call(5);
        RuntimeTable<ResultRow> result = new RuntimeTable<ResultRow>();
        result.AddColumn("p");
        CodeTable<anon_01d4cc8e3a2b48319db0232f6443d89a> fromTable = From_ad8aa9c326c9452ba50cac2f75ee1528();
        IEnumerator<anon_01d4cc8e3a2b48319db0232f6443d89a> x = fromTable.GetEnumerator();
        for (
        ; x.MoveNext();
        )
        {
            anon_01d4cc8e3a2b48319db0232f6443d89a row = x.Current;
            ResultRow resultRow = new ResultRow(1);
            resultRow[0] = row.t.p;
            result.Add(resultRow);
        }
        OnSelect(result);
        return result;
    }

    public void Step_f6aefd7c0765443e9efde3cea97d56a2()
    {
        Select_7ca4bd87ff3f4827a109268f4535bbd8();
        OnProgress();
    }

    public void Step_425b7f53a42945cc81285345532de574()
    {
        OnProgress(new ProgressArgs(TotalOperations, TotalOperations));
    }

    private class Scope_9f5fe3f765df4aea8674898da28507b1
    {

        public int g_identity;

        public Scope_9f5fe3f765df4aea8674898da28507b1()
        {
        }
    }

    private class Scope_61f4e38e4a504b83b816ad41eb5f0775
    {

        public CodeTable<temp> temp;

        public Scope_61f4e38e4a504b83b816ad41eb5f0775()
        {
            temp = new BufferTable<temp>();
        }
    }

    private class temp : IRow
    {

        public string val;
    }

    private class anon_c2089cb8821a4e9db698549f77af2c7d : IRow
    {

        public DownloadPage DownloadPage;
    }

    private class t : IRow
    {

        public string page;

        public string p;
    }

    private class anon_01d4cc8e3a2b48319db0232f6443d89a : IRow
    {

        public t t;
    }
}
