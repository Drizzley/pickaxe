//------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated by a tool.
//     Runtime Version:4.0.30319.34014
//
//     Changes to this file may cause incorrect behavior and will be lost if
//     the code is regenerated.
// </auto-generated>
//------------------------------------------------------------------------------

using Pickaxe.Runtime;
using Pickaxe.Runtime.Dom;
using System;
using System.Collections.Generic;
using System.Linq;



public class Code : RuntimeBase
{

    private Scope_6e3a90e02cee4f229b286a684de6421e _Scope_6e3a90e02cee4f229b286a684de6421e;

    private Scope_dcc4b7c8499e4197a03455cde96e15c1 _Scope_dcc4b7c8499e4197a03455cde96e15c1;

    public Code(string[] args) :
        base(args)
    {
        _Scope_6e3a90e02cee4f229b286a684de6421e = new Scope_6e3a90e02cee4f229b286a684de6421e();
        _Scope_dcc4b7c8499e4197a03455cde96e15c1 = new Scope_dcc4b7c8499e4197a03455cde96e15c1();
        TotalOperations = (TotalOperations + 1);
    }

    public void Run()
    {
        InitProxies();
        Block_6b3d6d31c86a4207912507b59d541006();
        Step_26d251a4dfa9417dacfdae1c7a3d9cd9();
    }

    public void Block_6b3d6d31c86a4207912507b59d541006()
    {
        Step_7d9272ec98de4aecaa4305e7f88a949d();
    }

    private CodeTable<anon_eab6da8a32e94a26882a7a0558618951> From_908fb39bd907444882ae3e5ff2d1dd1f()
    {
        Call(6);
        IEnumerable<anon_eab6da8a32e94a26882a7a0558618951> join = Fetch_2f31a35a417640e992b204eb34af2a9f();
        CodeTable<anon_eab6da8a32e94a26882a7a0558618951> newTable = new CodeTable<anon_eab6da8a32e94a26882a7a0558618951>();
        newTable.SetRows(join.ToList());
        return newTable;
    }

    private CodeTable<anon_8289296a7a2a4bffb1189c32789f8182> From_15b8b0cc778a4d799d8ab7a2b8d57cba()
    {
        Call(10);
        IEnumerable<anon_8289296a7a2a4bffb1189c32789f8182> join = Fetch_cc26f625b788459b88b054995842d354();
        CodeTable<anon_8289296a7a2a4bffb1189c32789f8182> newTable = new CodeTable<anon_8289296a7a2a4bffb1189c32789f8182>();
        newTable.SetRows(join.ToList());
        return newTable;
    }

    private RuntimeTable<DownloadPage> Download_31db81b269b64ade97a6cd87b2ff3209()
    {
        Call(10);
        return new SelectDownloadTable(Pickaxe.Runtime.LazyDownloadArgs.CreateWebRequestArgs(this, 10, 1, "http://vtss.brockreeve.com/?t=All"));
    }

    private IEnumerable<anon_8289296a7a2a4bffb1189c32789f8182> Fetch_cc26f625b788459b88b054995842d354()
    {
        RuntimeTable<DownloadPage> table = Download_31db81b269b64ade97a6cd87b2ff3209();
        return table.Select(o =>
        {
            return Copy_5d41e3cfe68848ea9d52c78fc1fcb5d6(o);
        });
    }

    private anon_8289296a7a2a4bffb1189c32789f8182 Copy_5d41e3cfe68848ea9d52c78fc1fcb5d6(DownloadPage o)
    {
        anon_8289296a7a2a4bffb1189c32789f8182 t = new anon_8289296a7a2a4bffb1189c32789f8182();
        t.DownloadPage = o;
        return t;
    }

    private CodeTable<b> Nested_Select_77d651be50ea44ebb6a09e3740ed4956()
    {
        Call(8);
        CodeTable<b> result = new BufferTable<b>();
        CodeTable<anon_8289296a7a2a4bffb1189c32789f8182> fromTable = From_15b8b0cc778a4d799d8ab7a2b8d57cba();
        fromTable = Where_1cdb8c7150ab4e38b19ee5f602ed149a(fromTable);
        IEnumerator<anon_8289296a7a2a4bffb1189c32789f8182> x = fromTable.GetEnumerator();
        for (
        ; x.MoveNext();
        )
        {
            anon_8289296a7a2a4bffb1189c32789f8182 row = x.Current;
            IEnumerator<HtmlElement> y = row.DownloadPage.nodes.GetEnumerator();
            for (
            ; y.MoveNext();
            )
            {
                HtmlElement node = y.Current;
                b resultRow = new b();
                resultRow.a0 = node.Pick("li.current a").TakeText();
                resultRow.a1 = node.Pick("li:nth-child(7) a").TakeText();
                result.Add(resultRow);
            }
            row.DownloadPage.Clear();
        }
        return result;
    }

    private CodeTable<anon_8289296a7a2a4bffb1189c32789f8182> Where_1cdb8c7150ab4e38b19ee5f602ed149a(CodeTable<anon_8289296a7a2a4bffb1189c32789f8182> table)
    {
        Call(11);
        CodeTable<anon_8289296a7a2a4bffb1189c32789f8182> newTable = new CodeTable<anon_8289296a7a2a4bffb1189c32789f8182>();
        IList<anon_8289296a7a2a4bffb1189c32789f8182> rows = table.Where(row =>
        {
            return row.DownloadPage.CssWhere(ref row.DownloadPage, "ol.page-nav");
        }).ToList();
        newTable.SetRows(rows);
        return newTable;
    }

    private IEnumerable<anon_eab6da8a32e94a26882a7a0558618951> Fetch_2f31a35a417640e992b204eb34af2a9f()
    {
        CodeTable<b> table = Nested_Select_77d651be50ea44ebb6a09e3740ed4956();
        return table.Select(o =>
        {
            return Copy_f0d20dfb776b4834b530040ba8bc304b(o);
        });
    }

    private anon_eab6da8a32e94a26882a7a0558618951 Copy_f0d20dfb776b4834b530040ba8bc304b(b o)
    {
        anon_eab6da8a32e94a26882a7a0558618951 t = new anon_eab6da8a32e94a26882a7a0558618951();
        t.b = o;
        return t;
    }

    private Table<ResultRow> Select_4c59fedff20a47ab88976f8cf90ca02f()
    {
        Call(5);
        RuntimeTable<ResultRow> result = new RuntimeTable<ResultRow>();
        result.AddColumn("a0");
        result.AddColumn("a1");
        CodeTable<anon_eab6da8a32e94a26882a7a0558618951> fromTable = From_908fb39bd907444882ae3e5ff2d1dd1f();
        IEnumerator<anon_eab6da8a32e94a26882a7a0558618951> x = fromTable.GetEnumerator();
        for (
        ; x.MoveNext();
        )
        {
            anon_eab6da8a32e94a26882a7a0558618951 row = x.Current;
            ResultRow resultRow = new ResultRow(2);
            resultRow[0] = row.b.a0;
            resultRow[1] = row.b.a1;
            result.Add(resultRow);
        }
        OnSelect(result);
        return result;
    }

    public void Step_7d9272ec98de4aecaa4305e7f88a949d()
    {
        Select_4c59fedff20a47ab88976f8cf90ca02f();
        OnProgress();
    }

    public void Step_26d251a4dfa9417dacfdae1c7a3d9cd9()
    {
        OnProgress(new ProgressArgs(TotalOperations, TotalOperations));
    }

    private class Scope_6e3a90e02cee4f229b286a684de6421e
    {

        public int g_identity;

        public Scope_6e3a90e02cee4f229b286a684de6421e()
        {
        }
    }

    private class Scope_dcc4b7c8499e4197a03455cde96e15c1
    {

        public CodeTable<temp> temp;

        public Scope_dcc4b7c8499e4197a03455cde96e15c1()
        {
            temp = new BufferTable<temp>();
        }
    }

    private class temp : IRow
    {

        public string val;
    }

    private class anon_8289296a7a2a4bffb1189c32789f8182 : IRow
    {

        public DownloadPage DownloadPage;
    }

    private class b : IRow
    {

        public string a0;

        public string a1;
    }

    private class anon_eab6da8a32e94a26882a7a0558618951 : IRow
    {

        public b b;
    }
}
