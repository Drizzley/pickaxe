//------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated by a tool.
//     Runtime Version:4.0.30319.34014
//
//     Changes to this file may cause incorrect behavior and will be lost if
//     the code is regenerated.
// </auto-generated>
//------------------------------------------------------------------------------

using Pickaxe.Runtime;
using Pickaxe.Runtime.Dom;
using System;
using System.Collections.Generic;
using System.Linq;



public class Code : RuntimeBase
{

    private Scope_1de9066709de4703a39e8231b6000ea4 _Scope_1de9066709de4703a39e8231b6000ea4;

    private Scope_5986a9eda8784589a1ee35a5e8116203 _Scope_5986a9eda8784589a1ee35a5e8116203;

    public Code(string[] args) :
        base(args)
    {
        _Scope_1de9066709de4703a39e8231b6000ea4 = new Scope_1de9066709de4703a39e8231b6000ea4();
        _Scope_5986a9eda8784589a1ee35a5e8116203 = new Scope_5986a9eda8784589a1ee35a5e8116203();
        TotalOperations = (TotalOperations + 1);
    }

    public void Run()
    {
        InitProxies();
        Block_1a464b6ca9534ccf9fde48b5cc93f82e();
        Step_69c47fa84cfc4e3b9f0fa377c3a42e46();
    }

    public void Block_1a464b6ca9534ccf9fde48b5cc93f82e()
    {
        Step_f2ef6b1554b243e78f2e71e6f10dc2ff();
    }

    private CodeTable<anon_94e48817bce7497f9a79c8c3123c9743> From_6e6b4e778db747d9a6203c87507b3a47()
    {
        Call(6);
        IEnumerable<anon_94e48817bce7497f9a79c8c3123c9743> join = Fetch_b9590a117efe41aea064baa2323f7e37();
        CodeTable<anon_94e48817bce7497f9a79c8c3123c9743> newTable = new CodeTable<anon_94e48817bce7497f9a79c8c3123c9743>();
        newTable.SetRows(join.ToList());
        return newTable;
    }

    private CodeTable<anon_ffec60c12d02440e81180c512b9bf1b5> From_071e61c9e5614035900c834f1954cbf6()
    {
        Call(10);
        IEnumerable<anon_ffec60c12d02440e81180c512b9bf1b5> join = Fetch_232de4269e6f41dbb8267bd614332305();
        CodeTable<anon_ffec60c12d02440e81180c512b9bf1b5> newTable = new CodeTable<anon_ffec60c12d02440e81180c512b9bf1b5>();
        newTable.SetRows(join.ToList());
        return newTable;
    }

    private RuntimeTable<DownloadPage> Download_97ce7b9c7a3146b194eeb172a8053bbb()
    {
        Call(10);
        return new SelectDownloadTable(Pickaxe.Runtime.LazyDownloadArgs.CreateWebRequestArgs(this, 10, 1, "http://vtss.brockreeve.com/?t=All"));
    }

    private IEnumerable<anon_ffec60c12d02440e81180c512b9bf1b5> Fetch_232de4269e6f41dbb8267bd614332305()
    {
        RuntimeTable<DownloadPage> table = Download_97ce7b9c7a3146b194eeb172a8053bbb();
        return table.Select(o =>
        {
            return Copy_7a9c830e62f541d9aa8ceedd686cbbaf(o);
        });
    }

    private anon_ffec60c12d02440e81180c512b9bf1b5 Copy_7a9c830e62f541d9aa8ceedd686cbbaf(DownloadPage o)
    {
        anon_ffec60c12d02440e81180c512b9bf1b5 t = new anon_ffec60c12d02440e81180c512b9bf1b5();
        t.DownloadPage = o;
        return t;
    }

    private CodeTable<b> Nested_Select_0261cdda18ff4b37b2097d86c9a3e3dc()
    {
        Call(8);
        CodeTable<b> result = new BufferTable<b>();
        CodeTable<anon_ffec60c12d02440e81180c512b9bf1b5> fromTable = From_071e61c9e5614035900c834f1954cbf6();
        fromTable = Where_6fae2910487240a7b872517e4f44db5f(fromTable);
        IEnumerator<anon_ffec60c12d02440e81180c512b9bf1b5> x = fromTable.GetEnumerator();
        for (
        ; x.MoveNext();
        )
        {
            anon_ffec60c12d02440e81180c512b9bf1b5 row = x.Current;
            IEnumerator<HtmlElement> y = row.DownloadPage.nodes.GetEnumerator();
            for (
            ; y.MoveNext();
            )
            {
                HtmlElement node = y.Current;
                b resultRow = new b();
                resultRow.page = node.Pick("li.current a").TakeText();
                resultRow.p = node.Pick("li:nth-child(7) a").TakeText();
                result.Add(resultRow);
            }
            row.DownloadPage.Clear();
        }
        return result;
    }

    private CodeTable<anon_ffec60c12d02440e81180c512b9bf1b5> Where_6fae2910487240a7b872517e4f44db5f(CodeTable<anon_ffec60c12d02440e81180c512b9bf1b5> table)
    {
        Call(11);
        CodeTable<anon_ffec60c12d02440e81180c512b9bf1b5> newTable = new CodeTable<anon_ffec60c12d02440e81180c512b9bf1b5>();
        IList<anon_ffec60c12d02440e81180c512b9bf1b5> rows = table.Where(row =>
        {
            return row.DownloadPage.CssWhere(ref row.DownloadPage, "ol.page-nav");
        }).ToList();
        newTable.SetRows(rows);
        return newTable;
    }

    private IEnumerable<anon_94e48817bce7497f9a79c8c3123c9743> Fetch_b9590a117efe41aea064baa2323f7e37()
    {
        CodeTable<b> table = Nested_Select_0261cdda18ff4b37b2097d86c9a3e3dc();
        return table.Select(o =>
        {
            return Copy_c365359b623d427fa65b2fcf17211d86(o);
        });
    }

    private anon_94e48817bce7497f9a79c8c3123c9743 Copy_c365359b623d427fa65b2fcf17211d86(b o)
    {
        anon_94e48817bce7497f9a79c8c3123c9743 t = new anon_94e48817bce7497f9a79c8c3123c9743();
        t.b = o;
        return t;
    }

    private Table<ResultRow> Select_326d87c9fe3d402cb348d1691195bcb8()
    {
        Call(5);
        RuntimeTable<ResultRow> result = new RuntimeTable<ResultRow>();
        result.AddColumn("page");
        result.AddColumn("p");
        CodeTable<anon_94e48817bce7497f9a79c8c3123c9743> fromTable = From_6e6b4e778db747d9a6203c87507b3a47();
        IEnumerator<anon_94e48817bce7497f9a79c8c3123c9743> x = fromTable.GetEnumerator();
        for (
        ; x.MoveNext();
        )
        {
            anon_94e48817bce7497f9a79c8c3123c9743 row = x.Current;
            ResultRow resultRow = new ResultRow(2);
            resultRow[0] = row.b.page;
            resultRow[1] = row.b.p;
            result.Add(resultRow);
        }
        OnSelect(result);
        return result;
    }

    public void Step_f2ef6b1554b243e78f2e71e6f10dc2ff()
    {
        Select_326d87c9fe3d402cb348d1691195bcb8();
        OnProgress();
    }

    public void Step_69c47fa84cfc4e3b9f0fa377c3a42e46()
    {
        OnProgress(new ProgressArgs(TotalOperations, TotalOperations));
    }

    private class Scope_1de9066709de4703a39e8231b6000ea4
    {

        public int g_identity;

        public Scope_1de9066709de4703a39e8231b6000ea4()
        {
        }
    }

    private class Scope_5986a9eda8784589a1ee35a5e8116203
    {

        public CodeTable<temp> temp;

        public Scope_5986a9eda8784589a1ee35a5e8116203()
        {
            temp = new BufferTable<temp>();
        }
    }

    private class temp : IRow
    {

        public string val;
    }

    private class anon_ffec60c12d02440e81180c512b9bf1b5 : IRow
    {

        public DownloadPage DownloadPage;
    }

    private class b : IRow
    {

        public string page;

        public string p;
    }

    private class anon_94e48817bce7497f9a79c8c3123c9743 : IRow
    {

        public b b;
    }
}
