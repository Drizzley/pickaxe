//------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated by a tool.
//     Runtime Version:4.0.30319.42000
//
//     Changes to this file may cause incorrect behavior and will be lost if
//     the code is regenerated.
// </auto-generated>
//------------------------------------------------------------------------------

using HtmlAgilityPack;
using Pickaxe.Runtime;
using System;
using System.Collections.Generic;
using System.Linq;



public class Code : RuntimeBase
{

    private Scope_fce54278f79e4b77933c5dd4131a4008 _Scope_fce54278f79e4b77933c5dd4131a4008;

    private Scope_4c0ca62b8fad428683fa7af25fb72629 _Scope_4c0ca62b8fad428683fa7af25fb72629;

    public Code(string[] args) :
            base(args)
    {
        _Scope_fce54278f79e4b77933c5dd4131a4008 = new Scope_fce54278f79e4b77933c5dd4131a4008();
        _Scope_4c0ca62b8fad428683fa7af25fb72629 = new Scope_4c0ca62b8fad428683fa7af25fb72629();
        TotalOperations = (TotalOperations + 2);
    }

    public void Run()
    {
        InitProxies();
        Block_3b2e93175b4d4c0eb51612cdcde0b6a6();
        Step_96a028028448410b84c32d7e49a3df07();
    }

    public void Block_3b2e93175b4d4c0eb51612cdcde0b6a6()
    {
        Step_2c94555730ba473eadd3602e5050e653();
        Step_acc173929ef74c7c902588c93ecbac2f();
    }

    private CodeTable<anon_dfa8cfed91c84666a6dff340dce23f3e> From_e3566bbdaec04e44bb723f4aee4c95f8()
    {
        Call(10);
        IEnumerable<anon_dfa8cfed91c84666a6dff340dce23f3e> join = Fetch_60605a21ee5e4ab88d628d6f1a899340();
        CodeTable<anon_dfa8cfed91c84666a6dff340dce23f3e> newTable = new CodeTable<anon_dfa8cfed91c84666a6dff340dce23f3e>();
        newTable.SetRows(join.ToList());
        return newTable;
    }

    private RuntimeTable<DownloadPage> Download_a4bbba47c4d244cfb815bdf743238872()
    {
        Call(10);
        return new SelectDownloadTable(Pickaxe.Runtime.LazyDownloadArgs.CreateWebRequestArgs(this, 10, 1, "http://doctor.webmd.com/find-a-doctor/specialties"));
    }

    private IEnumerable<anon_dfa8cfed91c84666a6dff340dce23f3e> Fetch_60605a21ee5e4ab88d628d6f1a899340()
    {
        RuntimeTable<DownloadPage> table = Download_a4bbba47c4d244cfb815bdf743238872();
        return table.Select(o => {
            return Copy_20241b7aa3a545c38458381a85f5851b(o);
        });
    }

    private anon_dfa8cfed91c84666a6dff340dce23f3e Copy_20241b7aa3a545c38458381a85f5851b(DownloadPage o)
    {
        anon_dfa8cfed91c84666a6dff340dce23f3e t = new anon_dfa8cfed91c84666a6dff340dce23f3e();
        t.DownloadPage = o;
        return t;
    }

    private Table<ResultRow> Select_2775af4bdf0344599ce891e6be59e50a()
    {
        Call(7);
        RuntimeTable<ResultRow> result = new RuntimeTable<ResultRow>();
        result.AddColumn("(No column name)");
        result.AddColumn("a");
        CodeTable<anon_dfa8cfed91c84666a6dff340dce23f3e> fromTable = From_e3566bbdaec04e44bb723f4aee4c95f8();
        fromTable = Where_d7d708612e4c44bfbe9053784a0d0f57(fromTable);
        IEnumerator<anon_dfa8cfed91c84666a6dff340dce23f3e> x = fromTable.GetEnumerator();
        for (
        ; x.MoveNext();
        )
        {
            anon_dfa8cfed91c84666a6dff340dce23f3e row = x.Current;
            IEnumerator<HtmlNode> y = row.DownloadPage.nodes.GetEnumerator();
            for (
            ; y.MoveNext();
            )
            {
                HtmlNode node = y.Current;
                ResultRow resultRow = new ResultRow(2);
                resultRow[0] = Pickaxe.Runtime.Helper.NullConcat("http://doctor.webmd.com", node.Pick("a").TakeAttribute("href"));
                resultRow[1] = node.Pick("a").TakeText();
                result.Add(resultRow);
            }
        }
        return result;
    }

    private CodeTable<anon_dfa8cfed91c84666a6dff340dce23f3e> Where_d7d708612e4c44bfbe9053784a0d0f57(CodeTable<anon_dfa8cfed91c84666a6dff340dce23f3e> table)
    {
        Call(11);
        CodeTable<anon_dfa8cfed91c84666a6dff340dce23f3e> newTable = new CodeTable<anon_dfa8cfed91c84666a6dff340dce23f3e>();
        IList<anon_dfa8cfed91c84666a6dff340dce23f3e> rows = table.Where(row => {
            return row.DownloadPage.CssWhere(ref row.DownloadPage, "section.seo-lists div:nth-child(3) li");
        }).ToList();
        newTable.SetRows(rows);
        return newTable;
    }

    private void Insert_a0158102036948e29192013e25c551f3()
    {
        Call(6);
        Table<ResultRow> resultRows = Select_2775af4bdf0344599ce891e6be59e50a();
        _Scope_4c0ca62b8fad428683fa7af25fb72629.specialty.BeforeInsert(false);
        _Scope_fce54278f79e4b77933c5dd4131a4008.g_identity = _Scope_4c0ca62b8fad428683fa7af25fb72629.specialty.RowCount;
        IEnumerator<ResultRow> x = resultRows.GetEnumerator();
        for (
        ; x.MoveNext();
        )
        {
            _Scope_fce54278f79e4b77933c5dd4131a4008.g_identity = (_Scope_fce54278f79e4b77933c5dd4131a4008.g_identity + 1);
            ResultRow row = x.Current;
            specialty tableRow = new specialty();
            tableRow.id = _Scope_fce54278f79e4b77933c5dd4131a4008.g_identity;
            tableRow.url = null;
            if ((row[0] != null))
            {
                tableRow.url = Convert.ToString(row[0]);
            }
            tableRow.spec = null;
            if ((row[1] != null))
            {
                tableRow.spec = Convert.ToString(row[1]);
            }
            _Scope_4c0ca62b8fad428683fa7af25fb72629.specialty.Add(tableRow);
        }
        _Scope_4c0ca62b8fad428683fa7af25fb72629.specialty.AfterInsert();
    }

    public void Step_2c94555730ba473eadd3602e5050e653()
    {
        Insert_a0158102036948e29192013e25c551f3();
        OnProgress();
    }

    private CodeTable<anon_9d4c2b5b7df84cf89c300db055238f8a> From_90c77db2a99640a9b0e8414a5f59d0d6()
    {
        Call(18);
        IEnumerable<anon_35031c851e1147e4ab0c7c525d891089> join = Fetch_9b94992d3afa4bc2a53fa05a7d657cc1();
        return Join_fd9cfe8c03e442609b301b470a9e4f49(join);
    }

    private CodeTable<anon_f1a586178d3c4d59943bbffe388eb1a8> From_c4f2dcdd7dbc41d9b2d1e8b807e32e84()
    {
        Call(18);
        IEnumerable<anon_f1a586178d3c4d59943bbffe388eb1a8> join = Fetch_8095d62113444450bace8c65af1da9e6();
        CodeTable<anon_f1a586178d3c4d59943bbffe388eb1a8> newTable = new CodeTable<anon_f1a586178d3c4d59943bbffe388eb1a8>();
        newTable.SetRows(join.ToList());
        return newTable;
    }

    private IEnumerable<anon_f1a586178d3c4d59943bbffe388eb1a8> Fetch_8095d62113444450bace8c65af1da9e6()
    {
        CodeTable<specialty> table = _Scope_4c0ca62b8fad428683fa7af25fb72629.specialty;
        return table.Select(o => {
            return Copy_141de9c4dfae49d89b25bd265ceaca5f(o);
        });
    }

    private anon_f1a586178d3c4d59943bbffe388eb1a8 Copy_141de9c4dfae49d89b25bd265ceaca5f(specialty o)
    {
        anon_f1a586178d3c4d59943bbffe388eb1a8 t = new anon_f1a586178d3c4d59943bbffe388eb1a8();
        t.specialty = o;
        return t;
    }

    private Table<ResultRow> Select_0738c2d109874396b3e7c86ffd6c36a7()
    {
        Call(18);
        RuntimeTable<ResultRow> result = new RuntimeTable<ResultRow>();
        result.AddColumn("url");
        CodeTable<anon_f1a586178d3c4d59943bbffe388eb1a8> fromTable = From_c4f2dcdd7dbc41d9b2d1e8b807e32e84();
        IEnumerator<anon_f1a586178d3c4d59943bbffe388eb1a8> x = fromTable.GetEnumerator();
        for (
        ; x.MoveNext();
        )
        {
            anon_f1a586178d3c4d59943bbffe388eb1a8 row = x.Current;
            ResultRow resultRow = new ResultRow(1);
            resultRow[0] = row.specialty.url;
            result.Add(resultRow);
        }
        return result;
    }

    private RuntimeTable<DownloadPage> Download_372dee704a544126b7a8a9f0b21e673e()
    {
        Call(18);
        return new SelectDownloadTable(Pickaxe.Runtime.LazyDownloadArgs.CreateWebRequestArgs(this, 18, 4, Select_0738c2d109874396b3e7c86ffd6c36a7()));
    }

    private IEnumerable<anon_35031c851e1147e4ab0c7c525d891089> Fetch_9b94992d3afa4bc2a53fa05a7d657cc1()
    {
        RuntimeTable<DownloadPage> table = Download_372dee704a544126b7a8a9f0b21e673e();
        return table.Select(o => {
            return Copy_a4ff5e80b19d412fa2279e7d3695caa5(o);
        });
    }

    private anon_35031c851e1147e4ab0c7c525d891089 Copy_a4ff5e80b19d412fa2279e7d3695caa5(DownloadPage o)
    {
        anon_35031c851e1147e4ab0c7c525d891089 t = new anon_35031c851e1147e4ab0c7c525d891089();
        t.d = o;
        return t;
    }

    private CodeTable<anon_9d4c2b5b7df84cf89c300db055238f8a> Join_fd9cfe8c03e442609b301b470a9e4f49(IEnumerable<anon_35031c851e1147e4ab0c7c525d891089> outer)
    {
        Call(19);
        IEnumerable<anon_9628e2b3a2514319b929a7b041dda745> table = Fetch_b58e7ec0f3b84fad9078adf399e67fcc();
        IList<anon_9d4c2b5b7df84cf89c300db055238f8a> join = new List<anon_9d4c2b5b7df84cf89c300db055238f8a>();
        IEnumerator<anon_35031c851e1147e4ab0c7c525d891089> o = outer.GetEnumerator();
        for (
        ; o.MoveNext();
        )
        {
            anon_35031c851e1147e4ab0c7c525d891089 oc = o.Current;
            IEnumerator<anon_9628e2b3a2514319b929a7b041dda745> i = table.GetEnumerator();
            for (
            ; i.MoveNext();
            )
            {
                anon_9628e2b3a2514319b929a7b041dda745 ic = i.Current;
                if ((ic.s.url == oc.d.url))
                {
                    anon_9d4c2b5b7df84cf89c300db055238f8a t = new anon_9d4c2b5b7df84cf89c300db055238f8a();
                    t.d = oc.d;
                    t.s = ic.s;
                    join.Add(t);
                }
            }
        }
        CodeTable<anon_9d4c2b5b7df84cf89c300db055238f8a> newTable = new CodeTable<anon_9d4c2b5b7df84cf89c300db055238f8a>();
        newTable.SetRows(join.ToList());
        return newTable;
    }

    private IEnumerable<anon_9628e2b3a2514319b929a7b041dda745> Fetch_b58e7ec0f3b84fad9078adf399e67fcc()
    {
        CodeTable<specialty> table = _Scope_4c0ca62b8fad428683fa7af25fb72629.specialty;
        return table.Select(o => {
            return Copy_a29c6f70dc474a3d9fe1418eac39965a(o);
        });
    }

    private anon_9628e2b3a2514319b929a7b041dda745 Copy_a29c6f70dc474a3d9fe1418eac39965a(specialty o)
    {
        anon_9628e2b3a2514319b929a7b041dda745 t = new anon_9628e2b3a2514319b929a7b041dda745();
        t.s = o;
        return t;
    }

    private Table<ResultRow> Select_04df2bd541394c5c9bedd10d1dbe8500()
    {
        Call(14);
        RuntimeTable<ResultRow> result = new RuntimeTable<ResultRow>();
        result.AddColumn("(No column name)");
        result.AddColumn("url");
        result.AddColumn("spec");
        CodeTable<anon_9d4c2b5b7df84cf89c300db055238f8a> fromTable = From_90c77db2a99640a9b0e8414a5f59d0d6();
        fromTable = Where_cb3a484ce1c04435a316a0f0dd8b21f3(fromTable);
        IEnumerator<anon_9d4c2b5b7df84cf89c300db055238f8a> x = fromTable.GetEnumerator();
        for (
        ; x.MoveNext();
        )
        {
            anon_9d4c2b5b7df84cf89c300db055238f8a row = x.Current;
            IEnumerator<HtmlNode> y = row.d.nodes.GetEnumerator();
            for (
            ; y.MoveNext();
            )
            {
                HtmlNode node = y.Current;
                ResultRow resultRow = new ResultRow(3);
                resultRow[0] = Pickaxe.Runtime.Helper.NullConcat("http://doctor.webmd.com", node.Pick("a").TakeAttribute("href"));
                resultRow[1] = row.d.url;
                resultRow[2] = row.s.spec;
                result.Add(resultRow);
            }
        }
        OnSelect(result);
        return result;
    }

    private CodeTable<anon_9d4c2b5b7df84cf89c300db055238f8a> Where_cb3a484ce1c04435a316a0f0dd8b21f3(CodeTable<anon_9d4c2b5b7df84cf89c300db055238f8a> table)
    {
        Call(20);
        CodeTable<anon_9d4c2b5b7df84cf89c300db055238f8a> newTable = new CodeTable<anon_9d4c2b5b7df84cf89c300db055238f8a>();
        IList<anon_9d4c2b5b7df84cf89c300db055238f8a> rows = table.Where(row => {
            return (Pickaxe.Runtime.Helper.Like(row.s.url, "blah") && row.d.CssWhere(ref row.d, "div.states li"));
        }).ToList();
        newTable.SetRows(rows);
        return newTable;
    }

    public void Step_acc173929ef74c7c902588c93ecbac2f()
    {
        Select_04df2bd541394c5c9bedd10d1dbe8500();
        OnProgress();
    }

    public void Step_96a028028448410b84c32d7e49a3df07()
    {
        OnProgress(new ProgressArgs(TotalOperations, TotalOperations));
    }

    private class Scope_fce54278f79e4b77933c5dd4131a4008
    {

        public int g_identity;

        public Scope_fce54278f79e4b77933c5dd4131a4008()
        {
        }
    }

    private class Scope_4c0ca62b8fad428683fa7af25fb72629
    {

        public CodeTable<specialty> specialty;

        public Scope_4c0ca62b8fad428683fa7af25fb72629()
        {
            specialty = new BufferTable<specialty>();
        }
    }

    private class specialty : IRow
    {

        public System.Nullable<int> id;

        public string url;

        public string spec;
    }

    private class anon_dfa8cfed91c84666a6dff340dce23f3e : IRow
    {

        public DownloadPage DownloadPage;
    }

    private class anon_f1a586178d3c4d59943bbffe388eb1a8 : IRow
    {

        public specialty specialty;
    }

    private class anon_35031c851e1147e4ab0c7c525d891089 : IRow
    {

        public DownloadPage d;
    }

    private class anon_9628e2b3a2514319b929a7b041dda745 : IRow
    {

        public specialty s;
    }

    private class anon_9d4c2b5b7df84cf89c300db055238f8a : IRow
    {

        public DownloadPage d;

        public specialty s;
    }
}
