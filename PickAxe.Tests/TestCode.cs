//------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated by a tool.
//     Runtime Version:4.0.30319.34014
//
//     Changes to this file may cause incorrect behavior and will be lost if
//     the code is regenerated.
// </auto-generated>
//------------------------------------------------------------------------------

using Pickaxe.Runtime;
using Pickaxe.Runtime.Dom;
using System;
using System.Collections.Generic;
using System.Linq;



public class Code : RuntimeBase
{

    private Scope_2711b47ee4a44e66ae5a805a72cc7e7d _Scope_2711b47ee4a44e66ae5a805a72cc7e7d;

    private Scope_462798afd2b1422b9168a726b4ca158d _Scope_462798afd2b1422b9168a726b4ca158d;

    public Code(string[] args) :
        base(args)
    {
        _Scope_2711b47ee4a44e66ae5a805a72cc7e7d = new Scope_2711b47ee4a44e66ae5a805a72cc7e7d();
        _Scope_462798afd2b1422b9168a726b4ca158d = new Scope_462798afd2b1422b9168a726b4ca158d();
        TotalOperations = (TotalOperations + 1);
    }

    public void Run()
    {
        InitProxies();
        Block_f3ad551c146a4c1da42cf85a788226f7();
        Step_fa222bf233a24167bed3fc74ff642d32();
    }

    public void Block_f3ad551c146a4c1da42cf85a788226f7()
    {
        Step_672a51fdf7ad4a07ae15e4ebd8debf1a();
    }

    private CodeTable<anon_94df364466e34b4184250118ab54182b> From_6a2b3d60e2174b3e94b77847e5921a8b()
    {
        Call(6);
        IEnumerable<anon_94df364466e34b4184250118ab54182b> join = Fetch_197b31047d6141e9bf35df5fb6dc434b();
        CodeTable<anon_94df364466e34b4184250118ab54182b> newTable = new CodeTable<anon_94df364466e34b4184250118ab54182b>();
        newTable.SetRows(join.ToList());
        return newTable;
    }

    private RuntimeTable<DownloadPage> Download_0225ebff35dd4167a2e89ca3cfbba705()
    {
        Call(6);
        return new SelectDownloadTable(Pickaxe.Runtime.LazyDownloadArgs.CreateWebRequestArgs(this, 6, 1, "http://mock.com"));
    }

    private IEnumerable<anon_94df364466e34b4184250118ab54182b> Fetch_197b31047d6141e9bf35df5fb6dc434b()
    {
        RuntimeTable<DownloadPage> table = Download_0225ebff35dd4167a2e89ca3cfbba705();
        return table.Select(o =>
        {
            return Copy_534b9c6eace64ab39ee91be96fdd7cac(o);
        });
    }

    private anon_94df364466e34b4184250118ab54182b Copy_534b9c6eace64ab39ee91be96fdd7cac(DownloadPage o)
    {
        anon_94df364466e34b4184250118ab54182b t = new anon_94df364466e34b4184250118ab54182b();
        t.DownloadPage = o;
        return t;
    }

    private Table<ResultRow> Select_c93bdfe92fdc40cfa1354807fc90cbf8()
    {
        Call(5);
        RuntimeTable<ResultRow> result = new RuntimeTable<ResultRow>();
        result.AddColumn("(No column name)");
        CodeTable<anon_94df364466e34b4184250118ab54182b> fromTable = From_6a2b3d60e2174b3e94b77847e5921a8b();
        fromTable = Where_5936ebf3f6c543b199289c9f4f91f2d8(fromTable);
        IEnumerator<anon_94df364466e34b4184250118ab54182b> x = fromTable.GetEnumerator();
        for (
        ; x.MoveNext();
        )
        {
            anon_94df364466e34b4184250118ab54182b row = x.Current;
            IEnumerator<HtmlElement> y = row.DownloadPage.nodes.GetEnumerator();
            for (
            ; y.MoveNext();
            )
            {
                HtmlElement node = y.Current;
                ResultRow resultRow = new ResultRow(1);
                resultRow[0] = Case_d5be73b1429b4b2b8295c79d62963a45(row, node);
                result.Add(resultRow);
            }
            row.DownloadPage.Clear();
        }
        OnSelect(result);
        return result;
    }

    private object Case_e6ec51a7400d4bb683519b5430a107a5(anon_94df364466e34b4184250118ab54182b row, HtmlElement node)
    {
        Call(5);
        if ((Convert.ToInt32(node.Pick("li:first-child").TakeText().Match("[\\d\\.]+")) < 9000))
        {
            return 2;
        }
        return null;
    }

    private object Case_d5be73b1429b4b2b8295c79d62963a45(anon_94df364466e34b4184250118ab54182b row, HtmlElement node)
    {
        Call(5);
        if ((Convert.ToInt32(node.Pick("li:first-child").TakeText().Match("[\\d\\.]+")) < 9000))
        {
            return 2;
        }
        return null;
    }

    private CodeTable<anon_94df364466e34b4184250118ab54182b> Where_5936ebf3f6c543b199289c9f4f91f2d8(CodeTable<anon_94df364466e34b4184250118ab54182b> table)
    {
        Call(7);
        CodeTable<anon_94df364466e34b4184250118ab54182b> newTable = new CodeTable<anon_94df364466e34b4184250118ab54182b>();
        IList<anon_94df364466e34b4184250118ab54182b> rows = table.Where(row =>
        {
            return row.DownloadPage.CssWhere(ref row.DownloadPage, "#match-tests");
        }).ToList();
        newTable.SetRows(rows);
        return newTable;
    }

    public void Step_672a51fdf7ad4a07ae15e4ebd8debf1a()
    {
        Select_c93bdfe92fdc40cfa1354807fc90cbf8();
        OnProgress();
    }

    public void Step_fa222bf233a24167bed3fc74ff642d32()
    {
        OnProgress(new ProgressArgs(TotalOperations, TotalOperations));
    }

    private class Scope_2711b47ee4a44e66ae5a805a72cc7e7d
    {

        public int g_identity;

        public Scope_2711b47ee4a44e66ae5a805a72cc7e7d()
        {
        }
    }

    private class Scope_462798afd2b1422b9168a726b4ca158d
    {

        public Scope_462798afd2b1422b9168a726b4ca158d()
        {
        }
    }

    private class anon_94df364466e34b4184250118ab54182b : IRow
    {

        public DownloadPage DownloadPage;
    }
}
